"use strict";(self.webpackChunktherynamo=self.webpackChunktherynamo||[]).push([[477],{10:e=>{e.exports=JSON.parse('{"blogPosts":[{"id":"happy-plants","metadata":{"permalink":"/blog/happy-plants","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2020-03-20-a-quest-for-happy-plants/index.mdx","source":"@site/blog/2020-03-20-a-quest-for-happy-plants/index.mdx","title":"\ud83c\udf3f A Quest for Happy Plants","description":"This article is also available on Dev.to where it was originally posted.","date":"2020-03-20T00:00:00.000Z","formattedDate":"March 20, 2020","tags":[{"label":"typescript","permalink":"/blog/tags/typescript"},{"label":"node","permalink":"/blog/tags/node"},{"label":"raspberry pi","permalink":"/blog/tags/raspberry-pi"},{"label":"automation","permalink":"/blog/tags/automation"}],"readingTime":10.515,"hasTruncateMarker":false,"authors":[{"name":"Theryn Groetken","title":"Dad, Software Engineer, Wanna-Be Horticulturist","url":"https://github.com/therynamo","imageURL":"https://github.com/therynamo.png","key":"me"}],"frontMatter":{"authors":"me","slug":"happy-plants","title":"\ud83c\udf3f A Quest for Happy Plants","tags":["typescript","node","raspberry pi","automation"]}},"content":"import { InlineBlogImage } from \\"../../src/components/Image/InlineBlogImage\\";\\n\\n:::tip Origination\\nThis article is also available on [Dev.to](https://dev.to/therynamo/a-quest-for-happy-plants-with-iot-14p1) where it was originally posted.\\n:::\\n\\nAutomating things has always been fascinating even when practicality is thrown out the window. It is incredible what you can do with just a little elbow grease.\\n\\nI recently started tending to plants in my time at home over the last year. Most of which ended up being vegetables. During that time I\'ve done a lot of reading about how to make my plants happy. One thing I know for sure, is even after a year of constant tending, I know nothing \ud83d\ude01. But that is the beauty of it, there is always something more to learn!\\n\\nIn my quest to make my plants happy, I came across myriad posts, articles, comments, etc. Each of which outlined many environmental specificities you must follow to give your plants the lives they deserve. And though plants (in our case vegetables) are resilient outside, once you bring them inside or use a different medium than soil (hydroponics) they become quite needy.\\n\\nThere are many factors that determine a quality environment for your plants. One of the keywords that kept coming up in my quest for the most joyful plants in the world was [\\"room humidity\\"](https://en.wikipedia.org/wiki/Humidity) (RH). According to Wikipedia, 30-50% humidity is a \\"normal\\" range for an average household. Our vegetables, however, like that humidity a little higher so they can breathe. In order to simulate a healthy growing environment for vegetation, we can shoot for ~70-75% RH. And that is what this post is going to focus on.\\n\\nHow to set up, track, and measure the temperature and room humidity of your space.\\n\\n# Part List\\n\\nI chose to use cheap-ish materials, but I\'m positive you could find a way to do this far cheaper than what I\'ve got here.\\n\\n- [Raspberry Pi 4 Model B](https://www.raspberrypi.org/products/raspberry-pi-4-model-b/)\\n- [200GB Sandisk MicroSD](https://www.amazon.com/gp/product/B08HCHS64Y/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&psc=1)\\n- [DHT11 Temp/Humidity Sensor](https://www.amazon.com/gp/product/B07WT2HJ4F/ref=ppx_yo_dt_b_asin_title_o06_s00?ie=UTF8&psc=1)\\n\\nThat\'s it! That is all you need to get up and running for this post.\\n\\n# Getting Started\\n\\nThankfully, there are many smart people out there on the internet with multiple tutorials on how to set up Raspbian on a Raspberry Pi. [Here is one such article from the folks over at MagPi](https://magpi.raspberrypi.org/articles/set-up-raspberry-pi-4) (there are many more, but this will be outside of what I\'m covering here).\\n\\nOnce you\'ve done that you\'ll want to enable SSH so you can develop remotely. [Here is a quick how to](https://www.raspberrypi.org/documentation/remote-access/ssh/) on that.\\n\\nOnce you\'ve got your RPi set up, you\'ll want to get all of your tools installed.\\n\\n## Tech Stack\\n\\n**On the RPi**\\n\\n- Node.js\\n  - TypeScript\\n- InfluxDB\\n- Grafana\\n\\n**Locally**\\n\\n- VSCode\\n- Any terminal ([iTerm](https://iterm2.com/) is great)\\n\\n## Node/Yarn\\n\\nI used [this article from Joshua Carter](https://morioh.com/p/95521373ce3d) to set up Node/Yarn.\\n\\n_Note_ I used the latest LTS version of node, which meant swapping out `12.X` for `14.X` in the first `cURL` command.\\n\\n## Influx/Grafana\\n\\nI followed a [great tutorial from Simon Hearne](https://simonhearne.com/2020/pi-influx-grafana/) on setting up Influx v1.X with Grafana.\\n\\n_Note_: If you want to run v2.X of InfluxDB, you\'ll need to be running a 64bit OS on your RPI. [More about that here](https://community.influxdata.com/t/trying-to-install-influxdb-2-0-beta-on-raspberry-pi-4b-w-4gb-ram/13153).\\n\\n## VSCode\\n\\nYou can run VSCode on your Raspberry Pi, and it may work great for you! I however, bought the 1GB RAM version of the RPi 4 Model B. Between `yarn install` and trying to write in VSCode, I ended up locking up my RPi.\\n\\nSo I thought, there has to be a better way to do this.\\n\\n> VSCode has entered the chat...\\n\\nRemember when, what may feel like an eternity ago, we enabled SSH on our RPi? Well it turns out VSCode [has the ability for us to write code remotely using SSH](https://code.visualstudio.com/learn/develop-cloud/ssh-lab-machines). This is the part of the project where I got all giddy. I am not a big fan of setting all of the intricate little pieces up. Where I start to see the possibilities and excitement is once I can write some code.\\n\\n---\\n\\nOnce you\'ve got all of the pieces assembled, you can start to look at putting the sensor on, and getting Node communicating with it.\\n\\nFor this next part, I liked to SSH into my RPi and do any `yarn` commands through the terminal on my remote machine. Any code written I would write in the VSCode enabled with SSH.\\n\\n# Code with Node\\n\\nHere is my `package.json` so you can get a view of what dependencies you\'ll be adding.\\n\\n```json title=\\"package.json\\"\\n{\\n  \\"scripts\\": {\\n    \\"start\\": \\"NODE_OPTIONS=--max_old_space_size=1000 TS_NODE_FILES=src/* nodemon src/index.ts -e ts\\",\\n    \\"build\\": \\"tsc\\",\\n    \\"vroom\\": \\"yarn build && NODE_OPTIONS=--max_old_space_size=1000 ./dist/src/index.js\\"\\n  },\\n  \\"devDependencies\\": {\\n    \\"@types/node-dht-sensor\\": \\"^0.4.0\\",\\n    \\"@typescript-eslint/eslint-plugin\\": \\"^4.18.0\\",\\n    \\"@typescript-eslint/parser\\": \\"^4.18.0\\",\\n    \\"eslint\\": \\"^7.22.0\\",\\n    \\"eslint-config-prettier\\": \\"^8.1.0\\",\\n    \\"eslint-plugin-jest\\": \\"^24.3.2\\",\\n    \\"eslint-plugin-node\\": \\"^11.1.0\\",\\n    \\"nodemon\\": \\"^2.0.7\\",\\n    \\"prettier\\": \\"^2.2.1\\",\\n    \\"ts-node\\": \\"^9.1.1\\",\\n    \\"typescript\\": \\"^4.2.3\\"\\n  },\\n  \\"dependencies\\": {\\n    \\"influx\\": \\"^5.8.0\\",\\n    \\"node-dht-sensor\\": \\"^0.4.3\\"\\n  }\\n}\\n```\\n\\n## TypeScript\\n\\nI\'ve recently become quite the TypeScript convert, so much so that I refuse to start a project without it. If you don\'t like TypeScript, or don\'t want to use it, feel free to skip to the next section.\\n\\n### Quick Start\\n\\n```bash\\nyarn add -D typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint eslint-config-prettier eslint-plugin-jest eslint-plugin-node nodemon prettier ts-node\\n```\\n\\nFrom here you can run `tsc --init` or you can copy my `tsconfig.json` below. (This will live at the root of your project directory)\\n\\n```json title=\\"tsconfig.json\\"\\n{\\n  \\"compilerOptions\\": {\\n    \\"target\\": \\"es6\\",\\n    \\"module\\": \\"commonjs\\",\\n    \\"declaration\\": true,\\n    \\"sourceMap\\": true,\\n    \\"outDir\\": \\"dist\\",\\n    \\"rootDir\\": \\"./\\",\\n    \\"strict\\": true,\\n    \\"esModuleInterop\\": true\\n  }\\n}\\n```\\n\\n_Note_: you don\'t need the following, they are just nice to have for any _JS/TS_ project to keep your code clean.\\n\\n**Eslint**\\n\\nWe can add two files to our root that give us a quick Eslint setup.\\n\\n```js title=\\".eslintrc.js\\"\\nmodule.exports = {\\n  root: true,\\n  parser: \\"@typescript-eslint/parser\\",\\n\\n  parserOptions: {\\n    ecmaVersion: 2020,\\n  },\\n  plugins: [\\"@typescript-eslint\\", \\"jest\\"],\\n  extends: [\\n    \\"eslint:recommended\\",\\n    \\"plugin:@typescript-eslint/recommended\\",\\n    \\"plugin:jest/recommended\\",\\n    \\"plugin:node/recommended\\",\\n    \\"prettier\\",\\n  ],\\n};\\n```\\n\\n```yml title=\\".eslintignore\\"\\n# don\'t ever lint node_modules\\nnode_modules\\n# don\'t lint build output (make sure it\'s set to your correct build folder name)\\ndist\\n# don\'t lint nyc coverage output\\ncoverage\\n```\\n\\n**Prettier**\\n\\n```js title=\\".prettierrc.js\\"\\nmodule.exports = {\\n  printWidth: 100,\\n  singleQuote: true,\\n  trailingComma: \\"es5\\",\\n};\\n```\\n\\n```yaml title=\\".prettierignore\\"\\nbuild\\ncoverage\\ndist\\n```\\n\\nEt Voila! We are all set and ready to go!\\n\\n## Project Dependencies\\n\\nThe meaty bits:\\n\\n```bash\\nyarn add influx node-dht-sensor\\n```\\n\\nThe explanation bits:\\n\\nAs you can see, we only have two dependencies: `influx` and `node-dht-sensor\\"`. You might be thinking, wait... I thought [Johnny Five](http://johnny-five.io/) was the go-to Node library for IoT. Well, you\'re not wrong! In fact, that is where this project started. It turns out, Johnny Five\'s examples only have the DHT11 sensors [with a backpack](http://johnny-five.io/examples/temperature-DHT11_I2C_NANO_BACKPACK/). Now, I\'m sure with some clever coding, and further understanding of GPIO and how Johnny Five interacts with them, you could definitely get \\"J5\\" to play nicely. That being said, we want EASY not difficult \ud83d\ude05.\\n\\nSo how are we going to talk to the DHT11 sensor from Node? [`node-dht-sensor`](https://github.com/momenso/node-dht-sensor) to the rescue. After some quick searching, it turns out, someone else has also had this problem (imagine that \ud83d\ude04). On their [`README`](https://github.com/momenso/node-dht-sensor#first-example), you\'ll find a helpful diagram for connecting your RPi and the sensor. From there, we can start writing some code!\\n\\n_Note_: I chose the same pins that their diagram shows and it worked great.\\n\\n[RPi GPIO Pin Diagram](https://www.raspberrypi.org/documentation/usage/gpio/)\\n\\n```\\n+ => 5v\\n- => Ground\\nout => Pin 4\\n```\\n\\n## Can We See Some Code Already?\\n\\n... Absolutely!\\n\\nThe folder structure will be quite simple, and should look like this:\\n\\n```\\n./src\\n|__ index.ts\\n```\\n\\nThe `index` file will look like this:\\n\\n```ts title=\\"index.ts\\"\\nimport { promises as sensor } from \\"node-dht-sensor\\";\\n\\nsetInterval(async () => {\\n  const { temperature, humidity } = await sensor.read(11, 4);\\n  console.log(`temp: ${temperature}\xb0C, humidity: ${humidity}%`);\\n}, 1000);\\n```\\n\\nYou tell the `read` function that you are using a `DHT11` sensor by saying `read(11`. The `read` function will then read the RPi boards `pin 4`, which is what you hooked your sensor up to. Every 1000ms, it will read from the sensor and output the results.\\n\\nGreat, now how do you start this up?\\n\\nFor fast iteration, I\'ve added `nodemon` and `ts-node` to this project. But if you look back at the `package.json` you\'ll notice one other prefix before our startup command.\\n\\n```\\nNODE_OPTIONS=--max_old_space_size=1000\\n```\\n\\n[Max old space size](https://nodejs.org/api/cli.html#cli_max_old_space_size_size_in_megabytes) is a node option we can pass that tells node how much memory it can afford to take up. This command is written in megabytes. From their documentation:\\n\\n> On a machine with 2GB of memory, consider setting this to 1536 (1.5GB) to leave some memory for other uses and avoid swapping.\\n\\nOn my machine, I have 1GB of memory, so I set it to 1000. If I was doing anything other than running this node project, I would set that a little lower just to give the RPi some room to breathe. If Node is left to its own devices, it can be a huge memory hog!\\n\\nThe rest of the command looks like this:\\n\\n```bash\\nTS_NODE_FILES=src/* nodemon src/index.ts -e ts\\n```\\n\\nA few things are going on here:\\n\\n- you\'re telling `ts-node` where it can find your files\\n- you\'re giving `nodemon` an entry point into your app (`src/index.ts`)\\n- you\'re telling `nodemon` to exec `ts`, invoking `ts-node`\\n\\nOnce you\'ve added this to your `scripts` in your `package.json` file, you can now run `yarn start` in your `ssh` terminal connected to your RPi.\\n\\nFinally, you get to see some code run!\\n\\nOnce you\'ve run `yarn start`, you should see your terminal start to output the following:\\n\\n```\\ntemperature: 20\xb0C, humidity: 39%\\n```\\n\\n(You may run into an issue where your script doesn\'t have permissions to read from GPIO. You can run `sudo yarn start`, or you can [do it the safe way with user permissions](https://www.raspberrypi.org/forums/viewtopic.php?t=5185#p161013)\\n\\nYour values will vary of course, unless your house is set to the same temp and have the same humidity \ud83d\ude04.\\n\\n\ud83c\udf89 Yay you did it! Now it is time to measure!\\n\\n# Grafana\\n\\nHaving set up InfluxDB and the Grafana UI, I can tell you\'re itching to get some visualizations built. Wait no longer!\\n\\nIn order to start streaming data points to your InfluxDB you can utilize the `influx` package you installed earlier.\\n\\nYou\'ll adjust your code in the `./src/index.ts` file to look like so:\\n\\n```ts title=\\"index.ts\\"\\nimport { InfluxDB, FieldType } from \\"influx\\";\\nimport { promises as sensor } from \\"node-dht-sensor\\";\\n\\nconst pass = process.env.IN_PASS;\\nconst influx = new InfluxDB({\\n  host: \\"localhost\\",\\n  username: \\"grafana\\",\\n  password: pass,\\n  database: \\"home\\",\\n  schema: [\\n    {\\n      measurement: \\"response_times\\",\\n      fields: {\\n        path: FieldType.STRING,\\n        duration: FieldType.INTEGER,\\n      },\\n      tags: [\\"sensor\\"],\\n    },\\n  ],\\n});\\n\\nsetInterval(async () => {\\n  const { temperature, humidity } = await sensor.read(11, 4);\\n  console.log(`temperature: ${temperature}\xb0C, humidity: ${humidity}%`);\\n\\n  try {\\n    influx.writePoints([\\n      {\\n        measurement: \\"humidity\\",\\n        tags: { sensor: \\"humidity\\" },\\n        fields: { humidity },\\n      },\\n      {\\n        measurement: \\"temp\\",\\n        tags: { sensor: \\"temperature\\" },\\n        fields: { temperature },\\n      },\\n    ]);\\n  } catch (e) {\\n    console.log(e);\\n  }\\n}, 1000);\\n```\\n\\nThere are a few new things here. I\'ll walk through them quickly:\\n\\n- First you initialize an instance of `InfluxDB` in your app.\\n- The configuration you pass that instance, is what will allow you to connect to the locally running db (You\'ll see `process.env.IN_PASS`, this is an env var exported with the password set to your db user `grafana`. It is always good practice to keep your credentials out of your scripts... even if it is your own code \ud83d\ude04)\\n- In your `setInterval` you\'ve added an `influx.writePoints` this is where the magic happens. Once every `1000`ms it will send influx data points tagged with its respective value.\\n\\nNow that you\'ve got data streaming to InfluxDB you can head over to Grafana. In Grafana you\'ll want to create a new dashboard. Once you\'ve done that, you\'ll create a new panel. Inside of that panel, it will allow you to start writing (or selecting) a query to Influx. If you\'ve set up your DB with all the same names as the tutorial outlined, your query should look something like this:\\n\\n```\\nSELECT mean(\\"humidity\\") FROM \\"humidity\\" WHERE $timeFilter GROUP BY time($__interval) fill(null)\\n```\\n\\n<InlineBlogImage\\n  size={800}\\n  src=\\"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/9rd3zncwz0tie43ckzh3.png\\"\\n  altText=\\"Influx DB Query\\"\\n/>\\n\\nAnd there you go! You\'ve got data visualizations in Grafana with data from InfluxDB all streaming from our Node \\"server\\" written in TypeScript!\\n\\n<InlineBlogImage\\n  size={800}\\n  src=\\"https://dev-to-uploads.s3.amazonaws.com/uploads/articles/dr99q35cirgx6u1gt350.png\\"\\n  altText=\\"Newly Updated Grafana Dashboard\\"\\n/>\\n\\n---\\n\\nFrom here, the possibilities are endless. You can start integrating with smart home api\'s to control switches, or send yourself alerts when humidity levels drop to low.\\n\\nIf you\'ve stayed with me through this whole process, thank you! I hope you\'ve enjoyed it, and had a little fun along the way. I certainly did \ud83d\ude04."}]}')}}]);